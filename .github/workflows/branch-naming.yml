name: "Branch Naming Convention"

on:
  pull_request:
    branches: [ "dev", "staging", "main" ]

jobs:
  check-branch-name:
    name: Check Branch Name
    runs-on: ubuntu-latest
    steps:
      - name: Validate branch naming convention
        run: |
          branch_name="${{ github.head_ref }}"
          
          echo "ğŸ” Checking branch name: '$branch_name'"
          
          # Skip check for protected branches
          if [[ $branch_name =~ ^(main|staging|dev)$ ]]; then
            echo "âœ… Protected branch '$branch_name' - skipping naming convention check"
            exit 0
          fi
          
          # Enforce naming convention for feature branches
          if [[ ! $branch_name =~ ^(feature|fix|hotfix|bugfix|chore|docs)/.+ ]]; then
            echo ""
            echo "âŒ Branch name '$branch_name' does not follow naming convention!"
            echo ""
            echo "ğŸ“‹ Branch Naming Rules:"
            echo "âœ… Protected branches (allowed): main, staging, dev"
            echo "âœ… Feature branches must use: feature/your-feature-name"
            echo "âœ… Bug fixes must use: fix/your-fix-name"
            echo "âœ… Allowed prefixes: feature/, fix/, hotfix/, bugfix/, chore/, docs/"
            echo ""
            echo "ğŸ“ Examples:"
            echo "  âœ… feature/user-authentication"
            echo "  âœ… fix/login-validation"
            echo "  âœ… hotfix/security-patch"
            echo "  âœ… bugfix/api-validation"
            echo "  âœ… chore/update-dependencies"
            echo "  âœ… docs/api-documentation"
            echo ""
            echo "âŒ Invalid examples:"
            echo "  âŒ new-feature (missing prefix)"
            echo "  âŒ my-branch (missing prefix)"
            echo "  âŒ test-branch (missing prefix)"
            echo ""
            echo "ğŸ”§ To fix: Rename your branch using:"
            echo "  git branch -m $branch_name feature/your-feature-name"
            echo ""
            exit 1
          fi
          
          echo "âœ… Branch name '$branch_name' follows naming convention!"
          echo "ğŸ‰ Ready to proceed with pull request!"