name: "Branch Naming Convention"

on:
  pull_request:
    branches: [ "dev", "staging", "main" ]

jobs:
  check-branch-name:
    name: Check Branch Name
    runs-on: ubuntu-latest
    steps:
      - name: Validate branch naming convention
        run: |
          branch_name="${{ github.head_ref }}"
          
          echo "🔍 Checking branch name: '$branch_name'"
          
          # Skip check for protected branches
          if [[ $branch_name =~ ^(main|staging|dev)$ ]]; then
            echo "✅ Protected branch '$branch_name' - skipping naming convention check"
            exit 0
          fi
          
          # Enforce naming convention for feature branches
          if [[ ! $branch_name =~ ^(feature|fix|hotfix|bugfix|chore|docs)/.+ ]]; then
            echo ""
            echo "❌ Branch name '$branch_name' does not follow naming convention!"
            echo ""
            echo "📋 Branch Naming Rules:"
            echo "✅ Protected branches (allowed): main, staging, dev"
            echo "✅ Feature branches must use: feature/your-feature-name"
            echo "✅ Bug fixes must use: fix/your-fix-name"
            echo "✅ Allowed prefixes: feature/, fix/, hotfix/, bugfix/, chore/, docs/"
            echo ""
            echo "📝 Examples:"
            echo "  ✅ feature/user-authentication"
            echo "  ✅ fix/login-validation"
            echo "  ✅ hotfix/security-patch"
            echo "  ✅ bugfix/api-validation"
            echo "  ✅ chore/update-dependencies"
            echo "  ✅ docs/api-documentation"
            echo ""
            echo "❌ Invalid examples:"
            echo "  ❌ new-feature (missing prefix)"
            echo "  ❌ my-branch (missing prefix)"
            echo "  ❌ test-branch (missing prefix)"
            echo ""
            echo "🔧 To fix: Rename your branch using:"
            echo "  git branch -m $branch_name feature/your-feature-name"
            echo ""
            exit 1
          fi
          
          echo "✅ Branch name '$branch_name' follows naming convention!"
          echo "🎉 Ready to proceed with pull request!"